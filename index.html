<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Customer CRM</title>
  <style>
    body { font-family: Arial, sans-serif; background: #f0f2f5; padding: 20px; margin:0;}
    .card { background:#fff; border-radius:8px; box-shadow:0 2px 6px rgba(0,0,0,0.1);
            margin:12px 0; padding:15px; display:flex; justify-content:space-between; align-items:center; }
    .name { font-size:16px; color:#333; flex:1; margin-right:10px; overflow:hidden;
            white-space:nowrap; text-overflow:ellipsis; }
    .buttons a { display:inline-block; margin-left:8px; padding:8px 12px; border-radius:6px;
                 text-decoration:none; color:#fff; font-size:14px; }
    .call { background:#4CAF50; }
    .whatsapp { background:#25D366; }
  </style>
</head>
<body>
  <h2>ðŸ“‹ Customer CRM</h2>
  <div id="list"></div>
  <script>
    const SHEET_ID = '1SarYnDPPke9ao2BB_nprgCMpafe_Xi_ksgJ52L0tVxc';
    const URL = `https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?tqx=out:json`;

    fetch(URL)
      .then(res => res.text())
      .then(txt => {
        const json = JSON.parse(txt.substr(txt.indexOf('{'), txt.lastIndexOf('}')+1));
        const cols = json.table.cols.map(c => c.label);
        const rows = json.table.rows.map(r => r.c.map(cell => cell?.v || ''));

        const nameIdx = cols.indexOf('Customer Name');
        const phoneIdx = cols.indexOf('Mobile Number');
        const waIdx = cols.indexOf('WhatsApp Number');

        const container = document.getElementById('list');
        rows.forEach(row => {
          const name = row[nameIdx] || '[No Name]';
          const phone = row[phoneIdx];
          const wa = row[waIdx] || phone;

          if (phone) {
            const card = document.createElement('div');
            card.className = 'card';
            const nameEl = document.createElement('div');
            nameEl.className = 'name';
            nameEl.textContent = name;
            const btns = document.createElement('div');
            btns.className = 'buttons';
            const call = document.createElement('a');
            call.className = 'call';
            call.href = `tel:${phone}`;
            call.textContent = 'ðŸ“ž Call';
            const waBtn = document.createElement('a');
            waBtn.className = 'whatsapp';
            waBtn.href = `https://wa.me/${wa}`;
            waBtn.target = '_blank';
            waBtn.textContent = 'ðŸ’¬ WhatsApp';

            btns.append(call, waBtn);
            card.append(nameEl, btns);
            container.append(card);
          }
        });
      })
      .catch(e => {
        console.error(e);
        document.getElementById('list').textContent = 'Error loading data.';
      });
  </script>
</body>
</html>
